<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico CMS - Debug</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 20px;
        }
        
        h1 {
            color: #4ec9b0;
            margin-bottom: 20px;
            border-bottom: 2px solid #3e3e42;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #9cdcfe;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 15px;
            background: #1e1e1e;
            border-left: 3px solid #007acc;
            border-radius: 3px;
        }
        
        .check {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            border-left: 4px solid;
        }
        
        .check.ok {
            background: #1a3a1a;
            border-left-color: #4ec9b0;
            color: #4ec9b0;
        }
        
        .check.error {
            background: #3a1a1a;
            border-left-color: #f48771;
            color: #f48771;
        }
        
        .check.warning {
            background: #3a3a1a;
            border-left-color: #dcdcaa;
            color: #dcdcaa;
        }
        
        .check.info {
            background: #1a2a3a;
            border-left-color: #569cd6;
            color: #569cd6;
        }
        
        code {
            background: #1e1e1e;
            padding: 2px 6px;
            border-radius: 3px;
            color: #ce9178;
        }
        
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 3px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid #3e3e42;
            color: #d4d4d4;
            font-size: 12px;
        }
        
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background: #005a9e;
        }
        
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: #1e1e1e;
            border-left: 2px solid #3e3e42;
            font-size: 12px;
        }
        
        .log-entry.success { border-left-color: #4ec9b0; }
        .log-entry.error { border-left-color: #f48771; }
        .log-entry.warning { border-left-color: #dcdcaa; }
        .log-entry.info { border-left-color: #569cd6; }
        
        .console-output {
            max-height: 300px;
            overflow-y: auto;
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagn√≥stico CMS - Debug</h1>
        
        <div class="section">
            <h2>Estado del Sistema</h2>
            <div id="status"></div>
        </div>
        
        <div class="section">
            <h2>Verificaciones</h2>
            <div id="checks"></div>
        </div>
        
        <div class="section">
            <h2>Datos Cargados</h2>
            <button onclick="cargarArticulos()">üîÑ Cargar Art√≠culos</button>
            <button onclick="crearArticuloTest()">‚ûï Crear Art√≠culo Test</button>
            <button onclick="limpiarConsola()">üóëÔ∏è Limpiar Consola</button>
            <div class="console-output" id="console"></div>
        </div>
        
        <div class="section">
            <h2>Informaci√≥n del DOM</h2>
            <button onclick="verificarDOM()">üìã Verificar DOM</button>
            <pre id="dom-info">Cargando informaci√≥n del DOM...</pre>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:3001/api';
        const log = [];
        
        function addLog(mensaje, tipo = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            log.push({ timestamp, mensaje, tipo });
            const consoleDiv = document.getElementById('console');
            const entry = document.createElement('div');
            entry.className = `log-entry ${tipo}`;
            entry.innerHTML = `<strong>[${timestamp}]</strong> ${mensaje}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function limpiarConsola() {
            document.getElementById('console').innerHTML = '';
            log.length = 0;
        }
        
        function addCheck(titulo, resultado, detalles = '') {
            const checksDiv = document.getElementById('checks');
            const check = document.createElement('div');
            check.className = `check ${resultado}`;
            check.innerHTML = `
                <strong>${titulo}</strong><br>
                ${detalles}
            `;
            checksDiv.appendChild(check);
        }
        
        async function verificarTodo() {
            addCheck('Verificando conectividad...', 'info', 'Por favor espera...');
            
            // Verificaci√≥n 1: Conectividad al servidor
            try {
                const response = await fetch(`${API_BASE}/articulos`);
                if (response.ok) {
                    addCheck('‚úì Servidor conectado', 'ok', 'http://localhost:3001 est√° corriendo');
                    addLog('‚úì Servidor conectado', 'success');
                } else {
                    addCheck('‚úó Error del servidor', 'error', `HTTP ${response.status}`);
                    addLog(`‚úó Error HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                addCheck('‚úó No hay conexi√≥n', 'error', `No se puede conectar a localhost:3001`);
                addLog(`‚úó Error de conexi√≥n: ${error.message}`, 'error');
            }
            
            // Verificaci√≥n 2: Elementos del DOM
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');
            addCheck('‚úì Elementos del DOM', 'ok', `${navItems.length} nav items, ${sections.length} sections`);
            
            // Verificaci√≥n 3: Funciones JavaScript
            const funcionesRequeridas = ['crearArticulo', 'eliminarArticulo', 'abrirEdicion', 'guardarEdicion', 'mostrarSeccion'];
            let funcionesOK = 0;
            funcionesRequeridas.forEach(f => {
                if (typeof window[f] === 'function') {
                    funcionesOK++;
                }
            });
            
            if (funcionesOK === funcionesRequeridas.length) {
                addCheck('‚úì Funciones JavaScript', 'ok', `${funcionesOK}/${funcionesRequeridas.length} funciones cargadas`);
            } else {
                addCheck('‚úó Funciones incompletas', 'warning', `${funcionesOK}/${funcionesRequeridas.length} funciones`);
            }
            
            // Verificaci√≥n 4: Formularios
            const formCreate = document.getElementById('articleForm');
            const formEdit = document.getElementById('editForm');
            if (formCreate && formEdit) {
                addCheck('‚úì Formularios', 'ok', 'Formularios de crear y editar presentes');
            } else {
                addCheck('‚úó Formularios faltantes', 'error', `Create: ${!!formCreate}, Edit: ${!!formEdit}`);
            }
        }
        
        async function cargarArticulos() {
            addLog('Cargando art√≠culos...', 'info');
            try {
                const response = await fetch(`${API_BASE}/articulos`);
                const data = await response.json();
                addLog(`‚úì Art√≠culos cargados: ${data.data?.length || 0}`, 'success');
                
                if (data.data && data.data.length > 0) {
                    addLog(`Primer art√≠culo: "${data.data[0].titulo || data.data[0].title}"`, 'info');
                }
                
                console.log('Datos cargados:', data);
            } catch (error) {
                addLog(`‚úó Error: ${error.message}`, 'error');
            }
        }
        
        async function crearArticuloTest() {
            addLog('Creando art√≠culo de prueba...', 'info');
            
            const articulo = {
                titulo: `Test ${new Date().getTime()}`,
                descripcion: 'Art√≠culo de prueba',
                cuerpo: 'Este es un art√≠culo de prueba del sistema de diagn√≥stico',
                autor: 'Sistema'
            };
            
            try {
                const response = await fetch(`${API_BASE}/articulos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(articulo)
                });
                
                const data = await response.json();
                if (response.ok) {
                    addLog(`‚úì Art√≠culo creado con ID ${data.data.id}`, 'success');
                } else {
                    addLog(`‚úó Error al crear: ${data.error}`, 'error');
                }
            } catch (error) {
                addLog(`‚úó Error: ${error.message}`, 'error');
            }
        }
        
        function verificarDOM() {
            let info = '=== INFORMACI√ìN DEL DOM ===\n\n';
            
            // Elementos cr√≠ticos
            const elementos = {
                'articleForm': document.getElementById('articleForm'),
                'editForm': document.getElementById('editForm'),
                'editModal': document.getElementById('editModal'),
                'articlesTableBody': document.getElementById('articlesTableBody'),
                'searchInput': document.getElementById('searchInput'),
                'newArticleBtn': document.getElementById('newArticleBtn')
            };
            
            info += '--- Elementos Cr√≠ticos ---\n';
            for (const [nombre, elemento] of Object.entries(elementos)) {
                info += `${nombre}: ${elemento ? '‚úì Encontrado' : '‚úó No encontrado'}\n`;
            }
            
            // Secciones
            const sections = document.querySelectorAll('.section');
            info += `\n--- Secciones (${sections.length} encontradas) ---\n`;
            sections.forEach(s => {
                info += `ID: ${s.id}, Class: ${s.className}\n`;
            });
            
            // Nav items
            const navItems = document.querySelectorAll('.nav-item');
            info += `\n--- Nav Items (${navItems.length} encontrados) ---\n`;
            navItems.forEach(n => {
                info += `data-section: ${n.getAttribute('data-section')}, Activo: ${n.classList.contains('active')}\n`;
            });
            
            // Funciones en window
            info += `\n--- Funciones Disponibles ---\n`;
            const funciones = ['crearArticulo', 'eliminarArticulo', 'abrirEdicion', 'guardarEdicion', 'mostrarSeccion', 'cargarArticulos'];
            funciones.forEach(f => {
                info += `${f}: ${typeof window[f] === 'function' ? '‚úì' : '‚úó'}\n`;
            });
            
            document.getElementById('dom-info').textContent = info;
        }
        
        // Ejecutar verificaciones al cargar
        window.addEventListener('load', () => {
            verificarTodo();
            verificarDOM();
        });
    </script>
</body>
</html>
